<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø§Øª</title>
    
    <!-- Ø¥Ø¶Ø§ÙØ© Ù…ØªØ·Ù„Ø¨Ø§Øª PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø§Øª">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: right;
        }

        th {
            background-color: #4CAF50;
            color: white;
        }

        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 14px;
        }

        .dashboard {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ccc;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.3s;
            margin: 5px;
        }

        .toggle-btn { background-color: #2196F3; color: white; }
        .add-btn { background-color: #4CAF50; color: white; }
        .export-btn { background-color: #9C27B0; color: white; }
        
        /* ØªØ­Ø³ÙŠÙ† Ù…Ø¸Ù‡Ø± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ² */
        input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 4px rgba(76, 175, 80, 0.5);
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ø¯Ø¹Ù… Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© */
        @media (max-width: 767px) {
            body {
                margin: 10px;
                font-size: 14px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            button {
                padding: 8px 12px;
                font-size: 0.9rem;
                width: 100%;
                margin: 5px 0;
            }
            
            th, td {
                padding: 8px;
            }
            
            /* Ø¹Ø±Ø¶ Ø·ÙˆÙ„ÙŠ Ù„Ù„Ø¬Ø¯ÙˆÙ„ ÙÙŠ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØµØºÙŠØ±Ø© */
            table, thead, tbody, th, td, tr {
                display: block;
            }
            
            thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            
            tr {
                margin-bottom: 15px;
                border: 1px solid #ddd;
            }
            
            td {
                position: relative;
                padding-right: 50%;
                text-align: right;
                border: none;
                border-bottom: 1px solid #eee;
            }
            
            td:before {
                position: absolute;
                right: 6px;
                width: 45%;
                white-space: nowrap;
                font-weight: bold;
            }
            
            td:nth-of-type(1):before { content: "ğŸ“¦ Ø§Ù„Ø´Ø­Ù†Ø©"; }
            td:nth-of-type(2):before { content: "ğŸ‘¤ Ø§Ù„Ø³Ø§Ø¦Ù‚"; }
            td:nth-of-type(3):before { content: "ğŸ Ù…Ø±ÙƒØ² Ø§Ù„Ø£ØºØ°ÙŠØ©"; }
            td:nth-of-type(4):before { content: "ğŸ“¦ Ù…Ø±ÙƒØ² ØºÙŠØ± Ø§Ù„Ø£ØºØ°ÙŠØ©"; }
            td:nth-of-type(5):before { content: "ğŸ­ Ù…Ø±ÙƒØ² 3"; }
        }

        /* Ø¥Ø¶Ø§ÙØ© Ø£Ø²Ø±Ø§Ø± Ø«Ø§Ø¨ØªØ© Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© */
        .mobile-actions {
            display: none;
        }
        
        @media (max-width: 767px) {
            .mobile-actions {
                display: flex;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: #fff;
                box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
                padding: 10px;
                z-index: 1000;
            }
            
            .mobile-actions button {
                flex: 1;
                margin: 0 5px;
            }
            
            /* Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§Ø­Ø© Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø© Ø­ØªÙ‰ Ù„Ø§ ØªØªØ¯Ø§Ø®Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø«Ø§Ø¨ØªØ© */
            body {
                padding-bottom: 70px;
            }
        }
    </style>
    <script>
        // ØªØ³Ø¬ÙŠÙ„ Service Worker Ù„Ù„Ø¯Ø¹Ù… Ø¨Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                .then(reg => console.log('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Service Worker Ø¨Ù†Ø¬Ø§Ø­'))
                .catch(err => console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Service Worker:', err));
            });
        }
    </script>
</head>
<body>
    <h1>ğŸª Ù†Ø¸Ø§Ù… ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø§Øª</h1>
    
    <button class="toggle-btn" onclick="toggleDashboard()">ğŸ“Š ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
    
    <div class="dashboard" id="dashboard" style="display: none;">
        <h2>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
        
        <p>Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„. ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</p>
        
        <button onclick="clearAllData()" style="background-color: #f44336; color: white;">
            ğŸ—‘ï¸ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        </button>
    </div>

    <table id="trackingTable">
        <thead>
            <tr>
                <th>ğŸ“¦ Ø§Ù„Ø´Ø­Ù†Ø©</th>
                <th>ğŸ‘¤ Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
                <th>ğŸ Ù…Ø®Ø²Ù† Ø§Ù„Ø£ØºØ°ÙŠØ©</th>
                <th>ğŸ“¦ Ù…Ø®Ø²Ù† ØºÙŠØ± Ø§Ù„Ø£ØºØ°ÙŠØ©</th>
                <th>ğŸ­ Ù…Ø®Ø²Ù† 3</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¶Ø§Ù Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
        </tbody>
    </table>
    
    <div style="margin-top: 20px;">
        <button class="add-btn" onclick="addNewRow()">â• ØµÙ Ø¬Ø¯ÙŠØ¯</button>
        <button class="export-btn" onclick="exportToExcel()">ğŸ“¤ ØªØµØ¯ÙŠØ± Ù„Ù„Ø¥ÙƒØ³Ù„</button>
    </div>
    
    <!-- Ø£Ø²Ø±Ø§Ø± Ø«Ø§Ø¨ØªØ© Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© -->
    <div class="mobile-actions">
        <button class="add-btn" onclick="addNewRow()">â•</button>
        <button class="toggle-btn" onclick="toggleDashboard()">âš™ï¸</button>
        <button class="export-btn" onclick="exportToExcel()">ğŸ“¤</button>
    </div>

    <script>
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', () => {
            loadFromLocalStorage();
            if (!document.getElementById('tableBody').children.length) {
                addNewRow();
            }
        });

        // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function toggleDashboard() {
            const dashboard = document.getElementById('dashboard');
            dashboard.style.display = dashboard.style.display === 'none' ? 'block' : 'none';
            document.querySelector('.toggle-btn').textContent = 
                dashboard.style.display === 'none' ? 'ğŸ“Š ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…' : 'âœ–ï¸ Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…';
        }

        // Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯
        function addNewRow() {
            const tbody = document.getElementById('tableBody');
            const newRow = document.createElement('tr');
            
            newRow.innerHTML = `
                <td><input type="text" class="shipment-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø´Ø­Ù†Ø©"></td>
                <td><input type="text" class="driver-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚"></td>
                <td><input type="text" class="scanner-input" placeholder="Ù…Ø§Ø³Ø­ Ø¶ÙˆØ¦ÙŠ"></td>
                <td><input type="text" class="scanner-input" placeholder="Ù…Ø§Ø³Ø­ Ø¶ÙˆØ¦ÙŠ"></td>
                <td><input type="text" class="scanner-input" placeholder="Ù…Ø§Ø³Ø­ Ø¶ÙˆØ¦ÙŠ"></td>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            const inputs = newRow.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', saveToLocalStorage);
            });
            
            tbody.appendChild(newRow);
            
            // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„ ÙÙŠ Ø§Ù„ØµÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            newRow.querySelector('input').focus();
            
            saveToLocalStorage();
            return newRow;
        }

        // Ø§Ù„ØªØµØ¯ÙŠØ± Ù„Ù„Ø¥ÙƒØ³Ù„ - Ù†Ø³Ø®Ø© Ù…Ø­Ø³Ù†Ø© Ù…Ø¹ ØªÙ†Ø³ÙŠÙ‚Ø§Øª
        function exportToExcel() {
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…ØµÙ†Ù Ø¬Ø¯ÙŠØ¯
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet([getHeaders(), ...getData()]);
            
            // ØªØ¹Ø±ÙŠÙ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª
            const headerStyle = {
                font: { sz: 14, bold: true, color: { rgb: "FFFFFF" } },
                fill: { fgColor: { rgb: "0070C0" } }, // Ø£Ø²Ø±Ù‚ Ø¯Ø§ÙƒÙ†
                alignment: { horizontal: "center" },
                border: {
                    top: { style: "thin", color: { rgb: "000000" } },
                    bottom: { style: "thin", color: { rgb: "000000" } },
                    left: { style: "thin", color: { rgb: "000000" } },
                    right: { style: "thin", color: { rgb: "000000" } }
                }
            };

            const dataStyle = {
                font: { sz: 12 },
                fill: { fgColor: { rgb: "C6EFCE" } }, // Ø£Ø®Ø¶Ø± ÙØ§ØªØ­
                alignment: { horizontal: "right" },
                border: {
                    top: { style: "thin", color: { rgb: "000000" } },
                    bottom: { style: "thin", color: { rgb: "000000" } },
                    left: { style: "thin", color: { rgb: "000000" } },
                    right: { style: "thin", color: { rgb: "000000" } }
                }
            };

            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„Ø§ÙŠØ§
            const range = XLSX.utils.decode_range(ws['!ref']);
            for(let R = range.s.r; R <= range.e.r; ++R) {
                for(let C = range.s.c; C <= range.e.c; ++C) {
                    const cell_address = {c:C, r:R};
                    const cell_ref = XLSX.utils.encode_cell(cell_address);
                    
                    if(R === 0) { // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
                        if (!ws[cell_ref].s) ws[cell_ref].s = {};
                        ws[cell_ref].s = headerStyle;
                    } else { // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        if (!ws[cell_ref].s) ws[cell_ref].s = {};
                        ws[cell_ref].s = dataStyle;
                    }
                }
            }

            // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© Ù„Ù„ÙˆØ±Ù‚Ø©
            ws['!cols'] = Array(5).fill({ wch: 25 }); // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
            ws['!rows'] = [{ hpx: 30 }]; // Ø§Ø±ØªÙØ§Ø¹ ØµÙ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ±Ù‚Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ØµÙ†Ù
            XLSX.utils.book_append_sheet(wb, ws, "Ø§Ù„Ø´Ø­Ù†Ø§Øª");
            
            // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù
            XLSX.writeFile(wb, `ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø´Ø­Ù†Ø§Øª_${new Date().toLocaleDateString('ar-EG')}.xlsx`);
        }

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
        function getHeaders() {
            return ['Ø§Ù„Ø´Ø­Ù†Ø©', 'Ø§Ù„Ø³Ø§Ø¦Ù‚', 'Ù…Ø±ÙƒØ² Ø§Ù„Ø£ØºØ°ÙŠØ©', 'Ù…Ø±ÙƒØ² ØºÙŠØ± Ø§Ù„Ø£ØºØ°ÙŠØ©', 'Ù…Ø±ÙƒØ² 3'];
        }

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function getData() {
            return Array.from(document.querySelectorAll('#tableBody tr')).map(row => 
                Array.from(row.querySelectorAll('input')).map(input => input.value)
            );
        }

        // Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        function saveToLocalStorage() {
            const data = Array.from(document.querySelectorAll('#tableBody tr')).map(row => 
                Array.from(row.querySelectorAll('input')).map(input => input.value)
            );
            localStorage.setItem('shipmentDataSimple', JSON.stringify(data));
        }

        function loadFromLocalStorage() {
            try {
                const savedData = JSON.parse(localStorage.getItem('shipmentDataSimple'));
                if (savedData && savedData.length > 0) {
                    document.getElementById('tableBody').innerHTML = '';
                    
                    savedData.forEach(row => {
                        const newRow = addNewRow();
                        const inputs = newRow.querySelectorAll('input');
                        
                        // ØªØ¹ÙŠÙŠÙ† Ù‚ÙŠÙ… Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
                        inputs.forEach((input, index) => {
                            if (row[index]) {
                                input.value = row[index];
                            }
                        });
                    });
                }
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
            }
        }

        // Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function clearAllData() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) {
                document.getElementById('tableBody').innerHTML = '';
                localStorage.removeItem('shipmentDataSimple');
                addNewRow();
            }
        }

        // Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        document.getElementById('tableBody').addEventListener('input', saveToLocalStorage);
        
        // Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            // Ù…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
            e.preventDefault();
            // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø­Ø¯Ø« Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„Ø§Ø­Ù‚Ù‹Ø§
            deferredPrompt = e;
            
            // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ù„Ù„ØªØ«Ø¨ÙŠØª Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø«Ø¨ØªÙ‹Ø§ Ø¨Ø§Ù„ÙØ¹Ù„
            const installButton = document.createElement('button');
            installButton.innerHTML = 'ğŸ“± ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚';
            installButton.style.backgroundColor = '#FF9800';
            installButton.style.color = 'white';
            installButton.style.margin = '10px 0';
            installButton.style.display = 'block';
            installButton.style.width = '100%';
            
            installButton.addEventListener('click', async () => {
                if (deferredPrompt) {
                    // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø±Ø¨Ø¹ Ø­ÙˆØ§Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª
                    deferredPrompt.prompt();
                    // Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    const { outcome } = await deferredPrompt.userChoice;
                    // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…ØªØºÙŠØ±
                    deferredPrompt = null;
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø²Ø± Ø¥Ø°Ø§ ØªÙ… Ø§Ù„ØªØ«Ø¨ÙŠØª Ø£Ùˆ Ø§Ù„Ø±ÙØ¶
                    installButton.style.display = 'none';
                }
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø²Ø± Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            const dashboard = document.getElementById('dashboard');
            dashboard.insertBefore(installButton, dashboard.firstChild);
        });
    </script>
</body>
</html>
